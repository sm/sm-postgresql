#!/bin/sh

typeset -x master_ip PGDATA masterFile debug entry pghaPath
debug=0

require_postgres_user
require_master_ip
require_pgdata

# TODO: Remove the directory below to use etcd.
pghaPath=${PGDATA}/../pgha # Parallel to PGDATA
masterFile=${pghaPath}/master
mkdir -p ${pghaPath}
chown -R postgres:postgres ${pghaPath}

if (( debug == 0 ))
then entry="* * * * * PGDATA=${PGDATA} /opt/sm/bin/sm pgha run"
else entry="* * * * * DEBUG=1 PGDATA=${PGDATA} /opt/sm/bin/sm pgha run"
fi

if ! crontab -l | grep -q 'pgha run'
then (crontab -l ; echo ${entry}) | crontab -
fi

