#!/usr/bin/env bash

echo "Job Started At: $(date)"

must_not_be_root

#Determine if this is the master, if so, run the base backup 
readOnly=$(psql postgres -t -A -c "SHOW transaction_read_only;")

if [[ ${readOnly} == "off" ]]
then WALE_SWIFT_PREFIX="swift://${swiftContainerName}" SWIFT_AUTHURL="${swiftAuthUrl}" SWIFT_TENANT="${swiftTenant}" SWIFT_USER="${swiftUser}" SWIFT_PASSWORD="${swiftPassword}" /usr/bin/wal-e backup-push ${pgData} 
else echo "This server is a replica, $0 command ignored."
fi

echo "Job Ended At: $(date)"

